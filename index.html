<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Intro a la programación en R</title>
    <meta charset="utf-8" />
    <meta name="author" content="  Creative Commons Attribution 4.0 International License" />
    <link href="index_files/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Intro a la programación en R
## Escuela de Invierno - Julio 2020 <br> Gabriela Mathieu
### <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>

---






# ¿Qué haremos hoy?

- Repaso del primer taller 
&lt;br&gt;
--

- Trabajar en proyecto (.Rproj)
&lt;br&gt;
--

- Definir una función para encontrar un dato faltante
&lt;br&gt;
--

- Definir una función para encontrar un caso duplicado
&lt;br&gt;
--

- Introducción al paquete dplyr para profundizar en el análisis de los datos de Barcelona
&lt;br&gt;
--

- Operadores lógicos y de comparación
&lt;br&gt;
--

- Encadenar funciones: operador %&gt;%
&lt;br&gt;
--

- Exportar objetos a archivos Rdata. Importar archivos Rdata.
&lt;br&gt;
--

- Buenas prácticas a la hora de escribir código

---
# Trabajar en proyecto

.pull-left[

Permite ordenar los diferentes archivos de un análisis y prescindir de usar setwd() y/o escribir rutas larguísimas. 

Si el archivo `tesis.Rproj` está ubicado en: `/home/calcita/Escritorio/tesis`, todos los archivos que estén en la carpeta tesis voy a poder cargarlos sin definir una ruta del archivo. 


```r
df &lt;- read_csv("datos.csv")
```

]

.pull-right[
&lt;img src="img/fd1.png" width="335" /&gt;

]

---
# Crear proyecto
&lt;img src="img/create_project.gif" height="10%" /&gt;

&lt;!-- ![]() --&gt;

---
# Cargar proyecto

![](img/load_project.gif)
---
# Importar archivos de un proyecto

![](img/read_project.gif)
&lt;!-- --- --&gt;
&lt;!-- # Estructura de un proyecto  --&gt;

&lt;!-- Una buena práctica es estructurar dichos archivos con cierta lógica que permita a otra persona entender qué es cada cosa y a la propia persona que lo hizo en un futuro.  --&gt;


---
# Importo los datos de Barcelona

Es una nueva sesión así que no tengo los objetos en memoria que tenía ayer.

Voy a usar la función `read_csv` del paquete `readr`. Hay dos maneras de hacerlo:


```r
library(readr) # cargo el paquete
listado &lt;- read_csv("data/listings.csv") #importo los datos
```
O en una sola línea


```r
#importo los datos indicando de que paquete es la función
listado &lt;- readr::read_csv("data/listings.csv") 
```
En esta segunda opción no queda cargado el paquete, pero como solo voy a usarlo en esta línea no me importa.

---
# Datos faltantes (NA)

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;is.na()&lt;/span&gt; chequea si hay un dato faltante (&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;NA: not available&lt;/span&gt;) para cada elemento de un vector. 
&lt;br&gt;&lt;br&gt;
--



```r
*x &lt;- c(-22, 4, -1, 8, NA)
x
```

```
[1] -22   4  -1   8  NA
```
- ¿Cuántos datos faltantes tiene x?
--

- Devuelve un &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;vector lógico&lt;/span&gt;, donde el TRUE indica que no hay dato y el FALSE que sí hay dato.


```r
*is.na(x)
```

```
[1] FALSE FALSE FALSE FALSE  TRUE
```
---
# Ejemplo: Datos faltantes (NA)




```r
faltantes &lt;- is.na(listado$price)
head(faltantes) # me muestra los primeros 6 valores/casos
```

```
[1] FALSE FALSE FALSE FALSE FALSE FALSE
```
--

- ¿Cuántos son los valores faltantes de  `price`?


```r
*sum(faltantes)
```

```
[1] 0
```

El valor lógico &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;TRUE&lt;/span&gt; representa al &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;1&lt;/span&gt; y el valor &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;FALSE&lt;/span&gt; representa al &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;0&lt;/span&gt; por eso puedo usar la función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;sum()&lt;/span&gt;. 

---
# Observaciones duplicadas

La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;duplicated()&lt;/span&gt; determina cuales elementos de un vector o data frame están duplicados, devuelve un vector lógico: TRUE si es duplicado y FALSE en caso contrario.
&lt;br&gt;&lt;br&gt;
--

- &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;Compara un elemento del vector con todos los anteriores&lt;/span&gt;, va asignando el valor FALSE hasta que se encuentra con un caso duplicado y en este caso le asigna TRUE y sigue comparando. 



```r
*x &lt;- c(-22, 4, 8, 8, NA)
x
```

```
[1] -22   4   8   8  NA
```
--

```r
*duplicated(x)
```

```
[1] FALSE FALSE FALSE  TRUE FALSE
```

---
# Ejemplo: observaciones duplicadas


- Chequeo que haya algún &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;caso duplicado&lt;/span&gt;, reviso todas las variables

```r
*repetidos &lt;- duplicated(listado) # el argumento es el data frame
*sum(repetidos) # los sumo, recordar: TRUE es 1 y FALSE es 0
```

```
[1] 0
```

- Chequeo que haya algún &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;valor duplicado&lt;/span&gt;  en la &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;variable identificatoria de cada caso&lt;/span&gt;


```r
*repetidos &lt;- duplicated(listado$host_id) # el argumento es una variable
*sum(repetidos)
```

```
[1] 10432
```

Si nombro a un objeto igual a uno existente, lo sobreescribo.

---
class: inverse, center, middle
# dplyr

---
# Manipular datos con dplyr


- El paquete dplyr permite representar la información de un &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;data frame&lt;/span&gt; en forma de &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;tabla&lt;/span&gt;, donde cada fila representa una observación y cada columna represente una variable.
&lt;br&gt;&lt;br&gt;
--

- dplyr no provee ninguna funcionalidad que no pueda ser realizada con las funciones del paquete base, sin embargo, es más simple y rápido (está escrito en C++).
&lt;br&gt;&lt;br&gt;
--

- Todas las funciones del paquete tiene la particularidad de que su  &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;primer argumento es un data frame&lt;/span&gt; al que le realizará la operación, mientras que los subsiguiente argumentos describen como realizar tal operación. 

- Finalmente el &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;resultado&lt;/span&gt; de todas estas funciones es un nuevo &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;data frame&lt;/span&gt;. Esto no ocurre con las funciones de base. 

---
class: center, middle
# ~~Base R vs. Tidyverse~~

![](img/base_tidy.png)
---
# Instalar y cargar dplyr

- La instalación es por única vez en una computadora. 

```r
# install.packages("dplyr") # ya lo tengo instalado
```
- Comenté esa línea porque ya lo tengo instalado
--

- En cada nueva sesión de RStudio lo debo cargar para poder usar sus funciones


```r
*library(dplyr)
```

![](img/alert.png) Notar que en la función de instalación el nombre del paquete se escribe entre comillas pero en la función de carga va sin comillas. No hagas ~~library("dplyr")~~.


---
# Manipular datos

- Seleccionar columnas/variables
&lt;br&gt;&lt;br&gt;
--

- Cambiar nombre de variables
&lt;br&gt;&lt;br&gt;
--

- Transformar variables
&lt;br&gt;&lt;br&gt;
--

- Crear nuevas variables
&lt;br&gt;&lt;br&gt;
--

- Filtrar o eliminar observaciones
&lt;br&gt;&lt;br&gt;
--

- Chequear existencia de observaciones duplicadas
&lt;br&gt;&lt;br&gt;
--

- Chequear existencia de datos faltantes
&lt;br&gt;&lt;br&gt;
--

- Reestructurar los datos

---
class: inverse, center, middle
# dplyr::select()

---
# Seleccionar columnas/variables 

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;select()&lt;/span&gt;  selecciona columnas de un data frame
--

- El primer argumento es el data frame y luego la(s) variable(s) separadas por coma.
--

- `select`(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;dataframe&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;variable&amp;gt;&lt;/span&gt;) 
--

.pull-left[

```r
*select(listado, host_name)
```

```
# A tibble: 20,708 x 1
   host_name       
   &lt;chr&gt;           
 1 Mireia And Maria
 2 Etain (Marnie)  
 3 Fidelio         
 4 Fidelio         
 5 Inge            
 6 Nick            
 7 Andres          
 8 Andres          
 9 Pablo           
10 Pablo           
# … with 20,698 more rows
```
]
.pull-rigth[


```r
*select(listado, host_id, host_name)
```

```
# A tibble: 20,708 x 2
   host_id host_name       
     &lt;dbl&gt; &lt;chr&gt;           
 1   71615 Mireia And Maria
 2   90417 Etain (Marnie)  
 3  136853 Fidelio         
 4  136853 Fidelio         
 5  141199 Inge            
 6  135703 Nick            
 7   73163 Andres          
 8   73163 Andres          
 9  152232 Pablo           
10  152232 Pablo           
# … with 20,698 more rows
```
]

![](img/alert.png) Las funciones de tidyverse permiten llamar a las variables de un data frame sin usar comillas pero esto no es aplicable al resto de los paquetes de R, incluido los del base.

---
# Seleccionar columnas/variables 

.pull-left[
Seleccionar un rango de columnas: select(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;desde&amp;gt;:&amp;lt;hasta&amp;gt;&lt;/span&gt;)


```r
select(listado, price:number_of_reviews)
```

```
# A tibble: 20,708 x 3
   price minimum_nights number_of_reviews
   &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;
 1    60              1                21
 2   210              3                52
 3    52              1               186
 4    58              1                91
 5    35             29                19
 6   140              2                60
 7   100              5                 8
 8   250              4               145
 9    40              2               292
10    30              2               245
# … with 20,698 more rows
```

]
.pull-right[
Seleccionar todas las columnas menos una: select(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;-&amp;lt;variable&amp;gt;&lt;/span&gt;)



```r
select(listado, -host_name)
```

```
# A tibble: 20,708 x 15
      id name  host_id neighbourhood_g… neighbourhood latitude longitude
   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
 1 18674 Huge…   71615 Eixample         la Sagrada F…     41.4      2.17
 2 23197 Foru…   90417 Sant Martí       el Besòs i e…     41.4      2.22
 3 31958 Gaud…  136853 Gràcia           el Camp d'en…     41.4      2.16
 4 32471 Gaud…  136853 Gràcia           el Camp d'en…     41.4      2.16
 5 32615 Sunn…  141199 Les Corts        les Corts         41.4      2.14
 6 32711 Sagr…  135703 Gràcia           el Camp d'en…     41.4      2.17
 7 34241 Priv…   73163 Ciutat Vella     el Barri Gòt…     41.4      2.18
 8 34981 VIDR…   73163 Ciutat Vella     el Barri Gòt…     41.4      2.18
 9 35379 Doub…  152232 Eixample         l'Antiga Esq…     41.4      2.15
10 35390 Sing…  152232 Eixample         l'Antiga Esq…     41.4      2.15
# … with 20,698 more rows, and 8 more variables: room_type &lt;chr&gt;, price &lt;dbl&gt;,
#   minimum_nights &lt;dbl&gt;, number_of_reviews &lt;dbl&gt;, last_review &lt;date&gt;,
#   reviews_per_month &lt;dbl&gt;, calculated_host_listings_count &lt;dbl&gt;,
#   availability_365 &lt;dbl&gt;
```

]

---
class: inverse, center, middle
# dplyr::slice()

---
# Seleccionar filas/observaciones por su posición

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;slice()&lt;/span&gt; selecciona observaciones/filas según su posición. 
--

- Esto no es robusto a un reordenamiento de las observaciones. Sirve para "ver" algunos casos.
--

- `slice`(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;nro_variable&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;nro_variable&amp;gt;&lt;/span&gt;)
--



.pull-left[

```r
# selecciono las filas 1 y 5
*slice(listado, 1, 5)
```

```
# A tibble: 2 x 3
     id price room_type      
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
1 18674    60 Entire home/apt
2 32615    35 Private room   
```
]


.pull-right[

```r
# selecciono las filas de 1 a 5
*slice(listado, 1:5)
```

```
# A tibble: 5 x 3
     id price room_type      
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
1 18674    60 Entire home/apt
2 23197   210 Entire home/apt
3 31958    52 Entire home/apt
4 32471    58 Entire home/apt
5 32615    35 Private room   
```

]

---
class: inverse, center, middle
# dplyr::filter()

---
# Selecciona observaciones según condición

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;filter()&lt;/span&gt; selecciona observaciones/filas según una condición.
--

- Puede ser una condición que involucre a una o varias variables. Condiciono a que tome o no tome ciertos valores.
--

- `filter`(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;condicion&amp;gt;&lt;/span&gt;)


```r
*menor25 &lt;- filter(listado, price &lt; 25) # me quedo con los casos cuyo precio es menor a 25
menor25
```

```
# A tibble: 1,704 x 3
       id price room_type   
    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
 1 147275    14 Private room
 2 179488    22 Private room
 3 179550    20 Private room
 4 193923    20 Private room
 5 194460    21 Private room
 6 256354    23 Private room
 7 296287    24 Private room
 8 333190    18 Private room
 9 378998    20 Private room
10 384867    20 Private room
# … with 1,694 more rows
```

---
class: inverse, center, middle
# Operadores comparativos

---
# Operadores de comparación 

.pull-left[
Mayor que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;gt;&lt;/span&gt;


```r
*filter(listado, price &gt; 60)
```

```
# A tibble: 9,804 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 23197   210 Entire home/apt
 2 32711   140 Entire home/apt
 3 34241   100 Private room   
 4 34981   250 Entire home/apt
 5 40983   130 Entire home/apt
 6 49968   140 Entire home/apt
 7 50066   180 Entire home/apt
 8 58512   125 Entire home/apt
 9 61444   105 Entire home/apt
10 67065    70 Entire home/apt
# … with 9,794 more rows
```

]
.pull-rigth[
Mayor igual que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;gt;=&lt;/span&gt;


```r
*filter(listado, price &gt;= 60)
```

```
# A tibble: 10,448 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 18674    60 Entire home/apt
 2 23197   210 Entire home/apt
 3 32711   140 Entire home/apt
 4 34241   100 Private room   
 5 34981   250 Entire home/apt
 6 40983   130 Entire home/apt
 7 49968   140 Entire home/apt
 8 50066   180 Entire home/apt
 9 58512   125 Entire home/apt
10 61444   105 Entire home/apt
# … with 10,438 more rows
```

]

---
# Operadores de comparación 

.pull-left[
Menor que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;&lt;/span&gt;


```r
*filter(listado, price &lt; 60)
```

```
# A tibble: 10,260 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 31958    52 Entire home/apt
 2 32471    58 Entire home/apt
 3 32615    35 Private room   
 4 35379    40 Private room   
 5 35390    30 Private room   
 6 35392    45 Private room   
 7 36763    30 Private room   
 8 46153    46 Entire home/apt
 9 68547    49 Private room   
10 70099    49 Private room   
# … with 10,250 more rows
```

]
.pull-rigth[

Menor igual que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;=&lt;/span&gt;


```r
*filter(listado, price &lt;= 60)
```

```
# A tibble: 10,904 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 18674    60 Entire home/apt
 2 31958    52 Entire home/apt
 3 32471    58 Entire home/apt
 4 32615    35 Private room   
 5 35379    40 Private room   
 6 35390    30 Private room   
 7 35392    45 Private room   
 8 36763    30 Private room   
 9 46153    46 Entire home/apt
10 68547    49 Private room   
# … with 10,894 more rows
```

]

---
# Operadores de comparación 

.pull-left[
Igual que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;==&lt;/span&gt;


```r
*filter(listado, price == 60)
```

```
# A tibble: 644 x 3
       id price room_type      
    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1  18674    60 Entire home/apt
 2  71736    60 Entire home/apt
 3  74562    60 Private room   
 4 100256    60 Entire home/apt
 5 119546    60 Private room   
 6 251424    60 Private room   
 7 256677    60 Private room   
 8 322268    60 Entire home/apt
 9 326464    60 Private room   
10 359841    60 Entire home/apt
# … with 634 more rows
```

]
.pull-rigth[

Diferente que: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;!=&lt;/span&gt;


```r
*filter(listado, price != 60)
```

```
# A tibble: 20,064 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 23197   210 Entire home/apt
 2 31958    52 Entire home/apt
 3 32471    58 Entire home/apt
 4 32615    35 Private room   
 5 32711   140 Entire home/apt
 6 34241   100 Private room   
 7 34981   250 Entire home/apt
 8 35379    40 Private room   
 9 35390    30 Private room   
10 35392    45 Private room   
# … with 20,054 more rows
```

]

---
class: inverse, center, middle
# Operadores lógicos

---
# Operadores lógicos

O lógico:  &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;|&lt;/span&gt;


```r
# selecciono alojamienos cuyo precio es menor a 60 o mayor a 80
*filter(listado, price &lt; 60 | price &gt; 80)
```

```
# A tibble: 17,523 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 23197   210 Entire home/apt
 2 31958    52 Entire home/apt
 3 32471    58 Entire home/apt
 4 32615    35 Private room   
 5 32711   140 Entire home/apt
 6 34241   100 Private room   
 7 34981   250 Entire home/apt
 8 35379    40 Private room   
 9 35390    30 Private room   
10 35392    45 Private room   
# … with 17,513 more rows
```


---
# Operadores lógicos

Y lógico:  &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;amp;&lt;/span&gt; 


```r
# selecciono alojamientos menor a 60 y que el tipo sea Private room 
*filter(listado, price &lt; 60 &amp; room_type == "Private room")
```

```
# A tibble: 8,151 x 3
       id price room_type   
    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
 1  32615    35 Private room
 2  35379    40 Private room
 3  35390    30 Private room
 4  35392    45 Private room
 5  36763    30 Private room
 6  68547    49 Private room
 7  70099    49 Private room
 8  83283    40 Private room
 9  95719    53 Private room
10 104485    35 Private room
# … with 8,141 more rows
```
--

---
# Operadores lógicos

No lógico: &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;!&lt;/span&gt;


```r
# selecciono alojamientos cuyo precio no es 60 euros
*filter(listado, !price == 60)
```

```
# A tibble: 20,064 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 23197   210 Entire home/apt
 2 31958    52 Entire home/apt
 3 32471    58 Entire home/apt
 4 32615    35 Private room   
 5 32711   140 Entire home/apt
 6 34241   100 Private room   
 7 34981   250 Entire home/apt
 8 35379    40 Private room   
 9 35390    30 Private room   
10 35392    45 Private room   
# … with 20,054 more rows
```

---
class: inverse, center, middle
# %in%

---
# Operador %in%

- &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;Compara cada elemento&lt;/span&gt; de un vector con los elementos de otro vector.
--

- &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;x&amp;gt; %in% &amp;lt;y&amp;gt;&lt;/span&gt;, el primer elemento de x se compara con todos los elementos de y, el segundo elemento de x se compara con todos los elementos de y, así sucesivamente. 
--

- Devuelve un TRUE o un FALSE en cada comparación. TRUE cuando el elemento de x está en y, FALSE en caso contrario.
--

- Cuando lo uso en `filter()` se queda con los TRUE. 


```r
# selecciono alojamientos cuyo tipo sea Private room  o Entire home/apt
filter(listado, room_type %in% c("Private room", "Entire home/apt"))
```

```
# A tibble: 19,990 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 18674    60 Entire home/apt
 2 23197   210 Entire home/apt
 3 31958    52 Entire home/apt
 4 32471    58 Entire home/apt
 5 32615    35 Private room   
 6 32711   140 Entire home/apt
 7 34241   100 Private room   
 8 34981   250 Entire home/apt
 9 35379    40 Private room   
10 35390    30 Private room   
# … with 19,980 more rows
```

En este caso es lo mismo que:

```r
# selecciono alojamientos menor a 60 y que el tipo sea Private room 
filter(listado, room_type == "Private room" | room_type == "Entire home/apt")
```

```
# A tibble: 19,990 x 3
      id price room_type      
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          
 1 18674    60 Entire home/apt
 2 23197   210 Entire home/apt
 3 31958    52 Entire home/apt
 4 32471    58 Entire home/apt
 5 32615    35 Private room   
 6 32711   140 Entire home/apt
 7 34241   100 Private room   
 8 34981   250 Entire home/apt
 9 35379    40 Private room   
10 35390    30 Private room   
# … with 19,980 more rows
```
---
# Ejercicio (12')

- Selecciona los casos que tienen entre de 10 y 20 evaluaciones y guarda en un objeto llamado `review_10_20`.
&lt;!-- review_10_20 &lt;- filter(listado, number_of_reviews &gt;= 10 &amp; number_of_reviews &lt;= 20) --&gt;

- Selecciona los casos que tienen solo 3 ó 5 días de disponibilidad y guarda en un objeto llamado `availability_3_5`.
&lt;!-- availability_3_5 &lt;- filter(listado, availability_365 %in% c(3,5)) --&gt;
&lt;!-- availability_3_5 &lt;- filter(listado, availability_365 == 3 | availability_365 == 5) --&gt;

- Selecciona los últimos 5 casos de listado y guarda en un objeto llamado `last_5`.
&lt;!-- last_5 &lt;- slice(listado, (nrow(listado)-4):nrow(listado)) --&gt;
 &lt;!-- last_5 &lt;- slice_tail(listado, n = 5) --&gt;
 
- Selecciona las variables referidas a reviews y guarda en un objeto llamado `reviews_name`. 
&lt;!-- reviews_name &lt;- listado %&gt;% select(contains("review")) --&gt;

- ¿Cuál es el alojamiento con mayor número de evaluaciones? Ver ?slice_max
&lt;!-- select(slice_max(listado, number_of_reviews), name)  --&gt;

---
class: inverse, center, middle
# dplyr::arrange()

---
# Ordenar las observaciones según una variable



La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;arrange()&lt;/span&gt; &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;ordena&lt;/span&gt; un data frame de acuerdo a una(s) variable(s) de manera &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;creciente&lt;/span&gt; por defecto.
--


```r
*arrange(listado, price)
```
--

Para ordenar de manera &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;decreciente&lt;/span&gt; debo incluir la función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;desc()&lt;/span&gt;:

```r
*arrange(listado, desc(price))
```
--
Para ordenar por más de una variable:

```r
arrange(listado, desc(price), last_review)
```

---
class: inverse, center, middle
# dplyr::summarise()

---
# Calcular un resumen de una variable

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;summarise()&lt;/span&gt; o &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;summarize()&lt;/span&gt; calcula un resumen de variables

- summarise(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;column&amp;gt;&lt;/span&gt; = &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;function&amp;gt;&lt;/span&gt;(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;variable&amp;gt;&lt;/span&gt;))

- El resultado será una data frame con una fila, a menos que los datos estén agrupados, y una columna por cada estadístico de resumen.


```r
*summarise(listado, promedio = mean(price))
```

```
# A tibble: 1 x 1
  promedio
     &lt;dbl&gt;
1     130.
```

- Se puede utilizar cualquier función que cumpla con que lo datos de entrada sean numericos y como salida se entregue una constante. Por ejemplo las funciones de resumen que vimos de R base: `mean`(), `max`(), `min`(), `median`(), `var`(), `sd`(), `sum`(), etc. Existen otras específicas de `dplyr` que iremos viendo.

---
# Calcular un resumen de una variable

- Se pueden aplicar diferentes funciones a la misma o diferentes variables


```r
# la función n() devuelve la cantidad de observaciones
*summarise(listado, promedio = mean(price), varianza = var(price), total = n())
```

```
# A tibble: 1 x 3
  promedio varianza total
     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
1     130.  194775. 20708
```

- Suele ser más claro escribirlo hacia abajo


```r
*summarise(listado, promedio = mean(price),
*                  varianza = var(price),
*                  total = n())
```

&lt;!-- n() - gives the number of observations --&gt;
&lt;!-- n_distinct(var) - gives the numbers of unique values of var --&gt;

---
class: inverse, center, middle
# dplyr::count()

---
# Cálculo frecuencias de una variable

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;count()&lt;/span&gt; es la función de dplyr para hacer una tabla de frecuencias, el resultado es siempre un data frame de menor dimensión que el original.
--

- count(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;variable&amp;gt;&lt;/span&gt;)
--

- En R base usamos `table()` pero el resultado no es un data frame y la salida no es muy amigable.
--


--

.pull-left[

```r
*count(listado,  room_type)
```

```
# A tibble: 4 x 2
  room_type           n
  &lt;chr&gt;           &lt;int&gt;
1 Entire home/apt  9393
2 Hotel room        513
3 Private room    10597
4 Shared room       205
```
]

--

.pull-right[

```r
*count(listado, room_type, neighbourhood)
```

```
# A tibble: 206 x 3
   room_type       neighbourhood                                    n
   &lt;chr&gt;           &lt;chr&gt;                                        &lt;int&gt;
 1 Entire home/apt Baró de Viver                                    1
 2 Entire home/apt Can Baró                                        23
 3 Entire home/apt Canyelles                                        1
 4 Entire home/apt Diagonal Mar i el Front Marítim del Poblenou   108
 5 Entire home/apt el Baix Guinardó                                56
 6 Entire home/apt el Barri Gòtic                                 597
 7 Entire home/apt el Besòs i el Maresme                           64
 8 Entire home/apt el Bon Pastor                                    3
 9 Entire home/apt el Camp de l'Arpa del Clot                     167
10 Entire home/apt el Camp d'en Grassot i Gràcia Nova             170
# … with 196 more rows
```

]

---
class: inverse, center, middle
# dplyr::mutate()

---
# Calculo una nueva variable 

- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;mutate()&lt;/span&gt; permite calcular nuevas variables
--

- mutate(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;nombre&amp;gt;&lt;/span&gt; = &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;calculo&amp;gt;&lt;/span&gt;)
--

- El resultado será de la &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;misma cantidad de observaciones&lt;/span&gt; que el data frame original
--

- Conviene guardarlo en el mismo objeto  (data frame original)
--


```r
*listado &lt;- mutate(listado, precio = price * 41)
slice(listado, 1:4)
```

```
# A tibble: 4 x 5
     id price room_type       neighbourhood                      precio
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;                               &lt;dbl&gt;
1 18674    60 Entire home/apt la Sagrada Família                   2460
2 23197   210 Entire home/apt el Besòs i el Maresme                8610
3 31958    52 Entire home/apt el Camp d'en Grassot i Gràcia Nova   2132
4 32471    58 Entire home/apt el Camp d'en Grassot i Gràcia Nova   2378
```

---
# Ejercicio (5')

- Calcula la variable precio en dólares estadounidenses y llamala price_uss. Toma la cotización 1 euro - 1.13 dólares. Calcula la variable precio en pesos uruguayo y llamala price_pesos. Toma la cotización 1 euro - 49 pesos.

- ¿Cuál es el máximo y mínimo de evaluaciones que ha recibido un alojamiento?


---
# Agrupo los casos por cierta variable



- La función &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;group_by()&lt;/span&gt; permite agrupar las observaciones por cierta variable.
--

- Permite hacer operaciones por grupos para posteriormente realizar otros cálculos.
--

- group_by(&lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;df&amp;gt;&lt;/span&gt;, &lt;span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #b3e2cd !important;" &gt;&amp;lt;variable&amp;gt;&lt;/span&gt;)
--


```r
# promedio de precio por barrio
*listado_gr &lt;- group_by(listado, neighbourhood_group)
*summarise(listado_gr, promedio = mean(price))
```

```
# A tibble: 10 x 2
   neighbourhood_group promedio
   &lt;chr&gt;                  &lt;dbl&gt;
 1 Ciutat Vella            87.2
 2 Eixample               182. 
 3 Gràcia                 130. 
 4 Horta-Guinardó          71.6
 5 Les Corts               97.7
 6 Nou Barris              47.8
 7 Sant Andreu             54.5
 8 Sant Martí             132. 
 9 Sants-Montjuïc          99.8
10 Sarrià-Sant Gervasi    169. 
```
--
- Lo más común es concatenar las funciones


```r
*summarise(group_by(listado, neighbourhood_group), promedio = mean(price))
```

```
# A tibble: 10 x 2
   neighbourhood_group promedio
   &lt;chr&gt;                  &lt;dbl&gt;
 1 Ciutat Vella            87.2
 2 Eixample               182. 
 3 Gràcia                 130. 
 4 Horta-Guinardó          71.6
 5 Les Corts               97.7
 6 Nou Barris              47.8
 7 Sant Andreu             54.5
 8 Sant Martí             132. 
 9 Sants-Montjuïc          99.8
10 Sarrià-Sant Gervasi    169. 
```
--
- En la línea anterior anidamos funciones para obtener el promedio según barrios.
- La anidación de funciones tiende a volver confuso el código...veremos luego cómo superar este inconveniente con el operador `%&gt;%`.

---
# Ejercicio (5')

- Calcula los precios precios promedios y máximos por barrio 

- Calcula los precios precios promedios y máximos por tipo de alojamiento
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"slideNumberFormat": "<div class=\"progress-bar-container\">   <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">   </div> </div>"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
